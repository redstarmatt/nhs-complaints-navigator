<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Public Body Complaints Navigator</title>
  <meta name="description" content="Free AI-powered tool to help UK citizens navigate complaints against any public body — NHS, councils, police, DWP, HMRC, schools, and more.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- ── Landing Page ── -->
  <div id="landing" class="landing" role="main">
    <div class="landing__logo">Complaints Navigator</div>
    <h1 class="landing__title">Navigate your complaint with confidence</h1>
    <p class="landing__subtitle">
      Free AI-powered guidance for complaints against any UK public body.
      We'll listen, find the right pathway, and help you draft your complaint.
    </p>
    <p class="landing__bodies">
      NHS &middot; Councils &middot; Police &middot; DWP &middot; HMRC &middot; Schools &middot; Social Care &middot; and more
    </p>
    <button id="start-btn" class="landing__cta">Start your complaint</button>

    <!-- Saved Sessions (populated by JS) -->
    <div id="saved-sessions" class="saved-sessions hidden"></div>

    <!-- Data management links -->
    <div id="landing-data-links" class="landing__data-links hidden">
      <button id="delete-all-data" class="landing__data-link">Delete all my data</button>
      <button id="landing-privacy-link" class="landing__data-link">Privacy notice</button>
    </div>

    <div class="landing__features">
      <div class="feature-card">
        <div class="feature-card__title">Tell your story</div>
        <div class="feature-card__desc">Describe what happened in your own words. No forms, no jargon.</div>
      </div>
      <div class="feature-card">
        <div class="feature-card__title">Find the right route</div>
        <div class="feature-card__desc">We identify the correct complaints pathway, step by step.</div>
      </div>
      <div class="feature-card">
        <div class="feature-card__title">Get your complaint drafted</div>
        <div class="feature-card__desc">AI drafts your complaint text — copy it into a form, send as an email, or post as a letter.</div>
      </div>
      <div class="feature-card">
        <div class="feature-card__title">Know your rights</div>
        <div class="feature-card__desc">Relevant legislation, deadlines, and escalation options explained clearly.</div>
      </div>
    </div>
  </div>

  <!-- ── Chat Interface ── -->
  <div id="chat-container" class="chat-container" role="main">
    <header class="chat-header">
      <button id="chat-back" class="chat-header__back" aria-label="Back to home">&larr; Back</button>
      <h1 class="chat-header__title">Complaints Navigator</h1>
      <div class="chat-header__controls">
        <button id="auto-read-toggle" class="auto-read-toggle" aria-label="Toggle auto-read responses" title="Auto-read AI responses aloud">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
            <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
            <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
          </svg>
          <span>Auto-read</span>
        </button>
      </div>
    </header>

    <div class="ai-disclaimer" role="status">AI can make mistakes. Check all information before acting on it. <span class="ai-disclaimer__detail">This tool provides general guidance, not legal advice.</span></div>

    <div id="chat-messages" class="chat-messages" role="log" aria-live="polite" aria-label="Chat messages">
      <div id="typing-indicator" class="typing-indicator" aria-label="AI is typing">
        <div class="typing-indicator__dots">
          <span class="typing-indicator__dot"></span>
          <span class="typing-indicator__dot"></span>
          <span class="typing-indicator__dot"></span>
        </div>
        <span id="typing-label" class="typing-indicator__label">Thinking...</span>
      </div>
    </div>

    <div class="chat-input-area">
      <textarea
        id="chat-input"
        class="chat-input"
        placeholder="Type your message..."
        rows="1"
        aria-label="Message input"
      ></textarea>
      <button id="chat-mic" class="chat-mic" aria-label="Voice input" title="Click to speak">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
          <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
          <line x1="12" y1="19" x2="12" y2="23"></line>
          <line x1="8" y1="23" x2="16" y2="23"></line>
        </svg>
      </button>
      <button id="chat-send" class="chat-send" aria-label="Send message">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
    </div>
  </div>

  <!-- ── Complaint Text Editor ── -->
  <div id="letter-container" class="letter-container" role="main">
    <header class="letter-header">
      <button id="letter-back" class="letter-header__back" aria-label="Back to chat">&larr; Back to chat</button>
      <h1 class="letter-header__title">Your Complaint Text</h1>
      <div style="width:60px"></div>
    </header>

    <div class="ai-disclaimer" role="status">AI can make mistakes. Check all information before acting on it. <span class="ai-disclaimer__detail">This tool provides general guidance, not legal advice.</span></div>

    <div class="letter-editor">
      <p class="letter-usage-hint">Edit the text below to make it your own, then copy it into an online complaint form, send it as an email, or download it as a letter to post.</p>
      <textarea
        id="letter-textarea"
        class="letter-textarea"
        aria-label="Complaint text editor"
        spellcheck="true"
      ></textarea>
      <div class="letter-review-gate">
        <label class="letter-review-gate__label">
          <input type="checkbox" id="letter-review-check">
          <span>I have reviewed this letter and confirm the facts are accurate. I understand this text was drafted by AI and I am responsible for checking it before sending.</span>
        </label>
      </div>
      <div class="letter-inline-actions">
        <button id="letter-copy" class="btn btn--primary" disabled>Copy to clipboard</button>
        <button id="letter-download-pdf" class="btn btn--green" disabled>Download PDF</button>
        <button id="letter-download-docx" class="btn btn--outline" disabled>Download Word</button>
        <button id="letter-print" class="btn btn--outline" disabled>Print</button>
      </div>
      <!-- Next Steps / Submission Panel (populated by JS) -->
      <div id="next-steps-container"></div>
    </div>
  </div>

  <!-- ── Complaint Diary ── -->
  <div id="diary-container" class="diary-container" role="main">
    <header class="diary-header">
      <button id="diary-back" class="diary-header__back" aria-label="Back">&larr; Back</button>
      <h1 class="diary-header__title">Complaint Diary</h1>
      <button id="diary-add" class="btn btn--primary btn--sm">Add entry</button>
    </header>
    <div class="ai-disclaimer" role="status">AI can make mistakes. Check all information before acting on it. <span class="ai-disclaimer__detail">This tool provides general guidance, not legal advice.</span></div>
    <div id="diary-entries" class="diary-entries"></div>
    <div id="diary-empty" class="diary-empty">No entries yet. Use the diary to track your complaint progress.</div>
  </div>

  <!-- ── Consent Gate ── -->
  <div id="consent-gate" class="consent-gate" role="dialog" aria-modal="true" aria-label="Data processing consent">
    <div class="consent-gate__card">
      <h2 class="consent-gate__title">Before you start</h2>
      <p class="consent-gate__intro">
        This tool helps you draft complaints about UK public services. To do that, it needs to process personal information you share — including details about your health, disability, or other sensitive matters.
      </p>
      <div class="consent-gate__section">
        <h3 class="consent-gate__heading">How your data is used</h3>
        <ul class="consent-gate__list">
          <li>What you type is sent to Google's Gemini AI to generate responses and draft your complaint. Google processes this data under a Data Processing Agreement.</li>
          <li>Your complaint details are saved in your browser's local storage so you can resume later. This data stays on your device.</li>
          <li>If you provide a postcode, it is sent to Postcodes.io and the UK Parliament API to identify your local services and MP.</li>
          <li>If you choose to send your complaint by email, it is sent via our email service to the public body you specify.</li>
        </ul>
      </div>
      <div class="consent-gate__section">
        <h3 class="consent-gate__heading">Your rights</h3>
        <p>You can delete all your data at any time from the home screen. Saved sessions are automatically deleted after 30 days. <button id="consent-privacy-link" class="consent-gate__link">Read the full privacy notice</button></p>
      </div>
      <div class="consent-gate__checks">
        <label class="consent-gate__check">
          <input type="checkbox" id="consent-check-1">
          <span>I understand my complaint details (which may include health and disability information) will be processed by Google's AI service to help draft my complaint.</span>
        </label>
        <label class="consent-gate__check">
          <input type="checkbox" id="consent-check-2">
          <span>I understand this tool does not report crimes or make safeguarding referrals on my behalf.</span>
        </label>
        <label class="consent-gate__check">
          <input type="checkbox" id="consent-check-3">
          <span>I confirm I am aged 18 or over (or I am a parent/guardian using this on behalf of someone under 18).</span>
        </label>
      </div>
      <button id="consent-accept" class="btn btn--primary consent-gate__accept" disabled>I agree — continue</button>
    </div>
  </div>

  <!-- ── Privacy Notice Modal ── -->
  <div id="privacy-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-label="Privacy notice">
    <div class="modal privacy-modal">
      <h2 class="modal__title">Privacy Notice</h2>
      <div class="privacy-modal__body">
        <h3>Who we are</h3>
        <p>Complaints Navigator is operated by [DATA CONTROLLER NAME AND CONTACT DETAILS TO BE INSERTED]. We are the data controller for the personal information you provide through this tool.</p>

        <h3>What we collect</h3>
        <p>When you use this tool, we process the following personal data:</p>
        <ul>
          <li><strong>Complaint details:</strong> Your description of what happened, names of staff involved, dates, desired outcome, and personal impact.</li>
          <li><strong>Special category data:</strong> Health information, disability details, mental health information, and other sensitive data you include in your complaint narrative.</li>
          <li><strong>Identifiers:</strong> NHS number, National Insurance number, claim reference numbers, or other identifiers you mention.</li>
          <li><strong>Location:</strong> Your postcode, if provided.</li>
          <li><strong>Contact details:</strong> Email address of the public body (not yours), if you use the email sending feature.</li>
        </ul>

        <h3>Why we process it and our lawful basis</h3>
        <p><strong>Lawful basis (Article 6):</strong> Your explicit consent (Article 6(1)(a) UK GDPR).</p>
        <p><strong>Special category condition (Article 9):</strong> Your explicit consent (Article 9(2)(a) UK GDPR).</p>
        <p>You can withdraw consent at any time by deleting your data using the "Delete all my data" option on the home screen. Withdrawal does not affect the lawfulness of processing before withdrawal.</p>

        <h3>Who receives your data</h3>
        <table class="privacy-modal__table">
          <thead><tr><th>Recipient</th><th>Data shared</th><th>Purpose</th></tr></thead>
          <tbody>
            <tr><td>Google (Gemini AI)</td><td>Complaint narrative (identifiers redacted where possible)</td><td>AI processing to generate responses and draft complaint text</td></tr>
            <tr><td>Postcodes.io</td><td>Postcode only</td><td>Identify local council, NHS body, police force</td></tr>
            <tr><td>UK Parliament API</td><td>Postcode only</td><td>Identify local MP</td></tr>
            <tr><td>Public body (if emailed)</td><td>Complaint letter</td><td>Submitting your complaint</td></tr>
          </tbody>
        </table>

        <h3>International transfers</h3>
        <p>Data sent to Google's Gemini AI may be processed outside the UK. This is covered by Google's Data Processing Addendum, which includes UK Standard Contractual Clauses and the UK-US Data Bridge.</p>

        <h3>How long we keep your data</h3>
        <ul>
          <li><strong>Browser storage:</strong> Saved sessions are automatically deleted after 30 days of inactivity. You can delete them sooner.</li>
          <li><strong>Google AI:</strong> Data sent to Google may be retained for a limited period for security and compliance purposes, as set out in Google's terms.</li>
          <li><strong>Our server:</strong> We do not store your complaint data on our server. It passes through only to reach the AI service.</li>
        </ul>

        <h3>Your rights</h3>
        <p>Under UK GDPR, you have the right to: access your data, rectify inaccuracies, erase your data, restrict processing, data portability, object to processing, and withdraw consent. To exercise these rights, contact [DATA CONTROLLER CONTACT]. You also have the right to lodge a complaint with the ICO (ico.org.uk).</p>

        <h3>Data minimisation</h3>
        <p>We redact identifiers (such as NHS numbers and National Insurance numbers) before sending your conversation to the AI service where possible. These are reinserted into the final complaint text locally on your device.</p>

        <h3>Children</h3>
        <p>This service is intended for adults aged 18 and over. If you are under 18, please ask a parent or guardian to use this tool on your behalf.</p>
      </div>
      <div class="modal__actions">
        <button id="privacy-modal-close" class="btn btn--primary">Close</button>
      </div>
    </div>
  </div>

  <!-- ── Toast ── -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- ── Scripts ── -->
  <script type="module">
    import { init } from './js/chat.js';
    init();
  </script>

</body>
</html>
